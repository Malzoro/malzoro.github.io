+++
title = 'Open Sesame - NAHAMCON 2023'
date = 2023-10-11T04:22:37-04:00
description = "Easy overflow challenge from NAHAMCON 2023 where we need to overwrite values on the stack local storage."
tags = ["overflow", "easy"]
draft = false
+++
Another really easy challenge from NAHAMCON, this time we're looking at a very simple buffer overflow.

I am guessing that this challenge is made to teach newbies to pwn.

# Taking a look behind the curtains
Opening the file in binary ninja, we can see that it uses the `scanf` function with the `%s` string specifier.

**HOWEVER**, the string specified does not contains some size checking (for example `%127s`).

So we can overflow the buffer that we're reading into, which is 256 bytes in size.

Now lets take a look at the source code of the challenge, since it was given along with it.

# Looking at the Source Code
Here's the source code of the challenge we're dealing with, it's relatively simple and the **core** of the challenge is located in the **caveOfGold** function.
```c
#include <stdlib.h>
#include <string.h>
#include <stdio.h>

#define SECRET_PASS "OpenSesame!!!"

typedef enum {no, yes} Bool;

void flushBuffers() {
    fflush(NULL);
}

void flag()
{
    system("/bin/cat flag.txt");
    flushBuffers();
}

Bool isPasswordCorrect(char *input)
{
    return (strncmp(input, SECRET_PASS, strlen(SECRET_PASS)) == 0) ? yes : no;
}

void caveOfGold()
{
    Bool caveCanOpen = no;
    char inputPass[256];

    puts("BEHOLD THE CAVE OF GOLD\n");

    puts("What is the magic enchantment that opens the mouth of the cave?");
    flushBuffers();

    scanf("%s", inputPass);

    if (caveCanOpen == no)
    {
        puts("Sorry, the cave will not open right now!");
        flushBuffers();
        return;
    }

    if (isPasswordCorrect(inputPass) == yes)
    {
        puts("YOU HAVE PROVEN YOURSELF WORTHY HERE IS THE GOLD:");
        flag();
    }
    else
    {
        puts("ERROR, INCORRECT PASSWORD!");
        flushBuffers();
    }
}

int main()
{
    setbuf(stdin, NULL);
    setbuf(stdout, NULL);
    caveOfGold();
    return 0;
}
```

Our goal is pretty obvious, we need to overwrite the **caveCanOpen** variable which is stored on the stack local storage **AND** our input needs to start with **OpenSesame!!!** our payload would look like the following.
```python
"OpenSesame!!!" + "A" * (272 - len("OpenSesame!!!"))
```
